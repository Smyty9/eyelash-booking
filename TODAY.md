# Что сделано за сегодня

## Дата: 23 ноября 2024

### ✅ Реализована админ-панель для управления услугами

#### 1. Структура админ-панели
- **`app/admin/layout.tsx`** - Layout с навигацией для админ-панели
  - Навигационное меню с ссылкой на "Услуги"
  - Стилизованный header с названием "Админ-панель"
  
- **`app/admin/page.tsx`** - Главная страница админки
  - Редирект на `/admin/services`

- **`app/admin/services/page.tsx`** - Страница управления услугами
  - Client-side компонент с состоянием
  - Загрузка списка услуг через API
  - Управление модальным окном формы
  - Обработчики для добавления, редактирования и удаления услуг
  - Интеграция с компонентами `ServicesTable` и `ServiceForm`

#### 2. API Routes для CRUD операций

- **`app/api/services/route.ts`**
  - `GET` - получение списка всех услуг (сортировка по дате создания)
  - `POST` - создание новой услуги
  - Валидация данных через Zod schema
  - Обработка ошибок с понятными сообщениями на русском

- **`app/api/services/[id]/route.ts`**
  - `PUT` - обновление существующей услуги
  - `DELETE` - удаление услуги
  - Валидация через Zod
  - Обработка ошибок (404 для несуществующих записей)

#### 3. React компоненты

- **`components/admin/services-table.tsx`**
  - Таблица для отображения услуг
  - Форматирование цены в рубли (₽)
  - Форматирование длительности (часы и минуты)
  - Отображение статуса (Активна/Неактивна) с цветовыми индикаторами
  - Кнопки редактирования и удаления для каждой услуги
  - Сообщение при отсутствии услуг

- **`components/admin/service-form.tsx`**
  - Модальное окно (Dialog) для добавления/редактирования услуг
  - Поля формы:
    - Название (обязательное)
    - Описание (опциональное)
    - Цена в рублях (обязательное, число)
    - Длительность в минутах (обязательное, целое число)
    - Чекбокс "Активна"
  - Валидация на клиенте и сервере
  - Обработка состояния загрузки
  - Отображение ошибок валидации
  - Автозаполнение при редактировании

#### 4. UI компоненты (Shadcn/UI)

Установлены и настроены следующие компоненты:
- **`components/ui/button.tsx`** - кнопки с вариантами стилей
- **`components/ui/dialog.tsx`** - модальные окна
- **`components/ui/input.tsx`** - поля ввода
- **`components/ui/label.tsx`** - метки для полей формы
- **`components/ui/table.tsx`** - таблицы

#### 5. Инфраструктура

- **`lib/prisma.ts`** - Singleton экземпляр Prisma Client
  - Оптимизация для Next.js (переиспользование в dev режиме)
  - Логирование запросов в development режиме

#### 6. База данных

- **`prisma/schema.prisma`** - Схема БД с моделью Service
  - Поля: id, name, description, price, durationMinutes, isActive, createdAt, updatedAt
  - Связь с моделью Appointment
  - Индексы для оптимизации

### Технические детали реализации

- Использован **Zod** для валидации данных на сервере
- **TypeScript** типизация для всех компонентов и API routes
- **Tailwind CSS** для стилизации
- **Lucide React** для иконок (Plus, Pencil, Trash2)
- Client-side состояние управление через React hooks (useState, useEffect)
- Обработка ошибок с понятными сообщениями на русском языке
- Responsive дизайн (адаптация под мобильные устройства)

### Функциональность

✅ Полный CRUD для услуг:
- Создание новой услуги
- Просмотр списка всех услуг
- Редактирование существующей услуги
- Удаление услуги (с подтверждением)

✅ Валидация:
- Обязательные поля (название, цена, длительность)
- Проверка типов данных
- Положительные значения для цены и длительности

✅ UX:
- Модальное окно для формы
- Индикаторы загрузки
- Сообщения об ошибках
- Подтверждение удаления
- Автоматическое обновление списка после операций

### ✅ Реализована публичная часть для клиентов

#### 1. Главная страница

- **`app/page.tsx`** - Server Component главной страницы
  - Загрузка активных услуг через server action
  - Отображение Hero секции и списка услуг
  - Оптимизация через Server Components

#### 2. Компоненты публичной части

- **`components/shared/hero.tsx`**
  - Hero секция с заголовком и описанием
  - Кнопка "Записаться онлайн" с плавной прокруткой к услугам
  - Адаптивная типографика

- **`components/shared/services-list.tsx`**
  - Отображение услуг в виде карточек (grid layout)
  - Форматирование цены в рубли с локализацией
  - Отображение длительности услуги
  - Кнопка "Записаться" для каждой услуги
  - Интеграция с BookingDrawer
  - Сообщение при отсутствии услуг

- **`components/shared/booking-drawer.tsx`**
  - Адаптивный компонент бронирования (Drawer на мобильных, Dialog на десктопе)
  - Трехшаговый процесс записи:
    1. **Выбор даты** - горизонтальный скролл с датами на 14 дней вперед
       - Форматирование: "Сегодня", "Завтра", или "День Месяц"
       - Отображение дня недели
    2. **Выбор времени** - сетка временных слотов (mock данные)
    3. **Контакты** - форма с полями:
       - Имя (обязательное)
       - Телефон с маской +7 (XXX) XXX-XX-XX (обязательное)
  - Валидация полей перед подтверждением
  - Автоматический сброс состояния при закрытии
  - Хук `useMediaQuery` для определения типа устройства

#### 3. Серверные действия

- **`lib/actions/services.ts`**
  - `getServices()` - получение активных услуг
  - Фильтрация по `isActive: true`
  - Сортировка по дате создания (новые первыми)
  - Обработка ошибок

#### 4. Дополнительные компоненты и утилиты

- **`components/ui/card.tsx`** - компонент карточки (Shadcn/UI)
  - Card, CardHeader, CardTitle, CardDescription, CardContent, CardFooter

- **`components/ui/drawer.tsx`** - компонент выдвижной панели (Vaul)
  - Адаптивная альтернатива Dialog для мобильных устройств

- **`hooks/use-media-query.ts`**
  - Хук для определения соответствия медиа-запросам
  - SSR-safe реализация
  - Автоматическая подписка на изменения

#### 5. Стилизация

- **`app/globals.css`**
  - Настроена цветовая схема (light/dark mode)
  - Кастомные CSS переменные для темизации
  - Утилита `.scrollbar-hide` для скрытия скроллбара

### Технические детали публичной части

- **Server Components** для оптимизации производительности
- **Адаптивный дизайн** - разные UI компоненты для мобильных и десктопов
- **Локализация** - форматирование дат и чисел для ru-RU
- **UX оптимизация** - плавная прокрутка, валидация в реальном времени
- **TypeScript** типизация всех компонентов

### Функциональность публичной части

✅ Отображение услуг:
- Список активных услуг с ценами и описаниями
- Адаптивная сетка карточек
- Форматирование данных для русской локали

✅ Процесс бронирования:
- Выбор даты из доступных (14 дней)
- Выбор времени из реальных доступных слотов (загружаются с сервера)
- Ввод контактных данных с валидацией
- Маска телефона для удобства ввода
- Сохранение записи в БД
- Проверка доступности времени перед созданием записи

### ✅ Реализован функционал бронирования

#### 1. API для создания записей

- **`app/api/appointments/route.ts`** - POST endpoint для создания записей
  - Валидация данных через Zod schema:
    - `serviceId` (UUID)
    - `date` (Date)
    - `time` (строка формата HH:MM)
    - `name` (обязательное)
    - `phone` (обязательное)
  - Нормализация телефона (удаление форматирования, оставляются только 10 цифр)
  - Поиск/создание пользователя через `upsert` по телефону
  - Проверка доступности времени перед созданием записи
  - Валидация: нельзя записаться на прошедшую дату
  - Обработка различных типов ошибок (400, 404, 409, 500)

#### 2. API для получения доступных временных слотов

- **`app/api/appointments/available-slots/route.ts`** - GET endpoint
  - Параметры: `serviceId` (UUID), `date` (YYYY-MM-DD)
  - Генерация временных слотов:
    - Рабочие часы: 10:00-18:00
    - Интервал между слотами: 30 минут
  - Фильтрация занятых слотов:
    - Получение всех записей на выбранную дату (исключая отмененные)
    - Проверка пересечений по времени с учетом длительности услуги
    - Исключение слотов, которые выходят за рабочие часы
  - Возврат только доступных слотов

#### 3. Интеграция формы бронирования с API

- **Обновлен `components/shared/booking-drawer.tsx`**
  - Загрузка доступных слотов из API при выборе даты
  - Отправка данных на сервер при подтверждении записи
  - Обработка успешной записи:
    - Красивое уведомление об успехе с иконкой
    - Отображение деталей записи (услуга, дата, время)
    - Автоматическое обновление списка доступных слотов
    - Автоматическое закрытие drawer через 2 секунды
  - Улучшенная обработка ошибок:
    - Детальные сообщения для разных типов ошибок (400, 404, 409, 500)
    - Отображение ошибок валидации из Zod
    - Обработка ошибок при загрузке слотов
  - UX улучшения:
    - Визуальная обратная связь при успехе (зеленое уведомление с иконкой)
    - Блокировка кнопки после успешной записи
    - Индикатор загрузки при отправке данных
    - Состояние загрузки слотов
    - Автоматический сброс всех состояний при закрытии drawer
    - Улучшенная типографика для сообщений

#### 4. Обновлен `components/shared/services-list.tsx`
  - Передача `serviceId` в `BookingDrawer` для корректной работы API

---

## Дата: 24 ноября 2024

### Краткое резюме

Сегодня реализована полная админ-панель для управления записями, исправлены критические баги с перезаписью имени клиента и часовыми поясами, добавлена страница настроек рабочего времени. Система теперь полностью функциональна для управления записями клиентов.

### ✅ Реализована админ-панель для управления записями

#### 1. Страница управления записями

- **`app/admin/appointments/page.tsx`** - Страница управления записями
  - Client-side компонент с состоянием
  - Загрузка списка записей через API с фильтрацией
  - Управление модальным окном формы редактирования
  - Обработчики для редактирования, удаления и изменения статуса записей
  - Интеграция с компонентами `AppointmentsTable`, `AppointmentFilters` и `AppointmentForm`

#### 2. API Routes для работы с записями

- **`app/api/appointments/route.ts`** - Расширен функционал
  - `GET` - получение списка записей с фильтрацией:
    - По статусу (PENDING, CONFIRMED, CANCELED)
    - По услуге (serviceId)
    - По диапазону дат (dateFrom, dateTo)
    - Поиск по имени клиента (clientName) или телефону
  - `POST` - создание записи с сохранением clientName
  - Исправлена работа с часовыми поясами (использование UTC)

- **`app/api/appointments/[id]/route.ts`** - CRUD операции для конкретной записи
  - `PUT` - обновление записи (дата, время, услуга, имя клиента, статус)
  - `DELETE` - удаление записи
  - Проверка доступности времени при изменении даты/времени
  - Работа с clientName вместо user.name

- **`app/api/appointments/[id]/status/route.ts`** - Изменение статуса записи
  - `PATCH` - быстрое изменение статуса (PENDING, CONFIRMED, CANCELED)
  - Валидация через Zod

- **`app/api/appointments/available-slots/route.ts`** - Обновлен
  - Исправлена работа с часовыми поясами (UTC)
  - Использование настроек из БД (рабочие часы, интервал)

#### 3. React компоненты

- **`components/admin/appointments-table.tsx`**
  - Таблица для отображения записей
  - Форматирование даты и времени (локальное отображение UTC времени)
  - Форматирование телефона (+7 (XXX) XXX-XX-XX)
  - Отображение статуса с цветовыми индикаторами и иконками
  - Кнопки действий: подтвердить, отменить, редактировать, удалить
  - Сообщение при отсутствии записей

- **`components/admin/appointment-filters.tsx`**
  - Фильтры для поиска записей:
    - Поиск по имени/телефону (debounce 500ms)
    - Фильтр по статусу
    - Фильтр по услуге
    - Фильтр по диапазону дат (от/до)
  - Кнопка сброса фильтров
  - Адаптивная сетка фильтров

- **`components/admin/appointment-form.tsx`**
  - Модальное окно для редактирования записи
  - Поля формы:
    - Услуга (выбор из списка)
    - Дата (date input)
    - Время (выбор из доступных слотов)
    - Имя клиента (обязательное)
    - Телефон с маской (обязательное)
    - Статус (выбор из списка)
  - Автоматическая загрузка доступных слотов при изменении даты/услуги
  - Валидация на клиенте и сервере
  - Отображение ошибок

#### 4. Страница настроек

- **`app/admin/settings/page.tsx`** - Страница настроек рабочего времени
  - Управление началом рабочего дня (8:00-20:00)
  - Управление концом рабочего дня (14:00-24:00)
  - Управление интервалом между слотами (15/30/60 минут)
  - Валидация (начало < конца)
  - Сохранение настроек в БД

- **`app/api/settings/route.ts`** - API для настроек
  - `GET` - получение настроек (создание дефолтных, если нет)
  - `PUT` - обновление настроек
  - Валидация через Zod

#### 5. Исправления и улучшения

- **Исправлена проблема с перезаписью имени клиента**
  - Добавлено поле `clientName` в модель `Appointment`
  - Каждая запись хранит свое имя клиента отдельно
  - При создании записи на один телефон с разными именами, имена не перезаписываются
  - Миграция БД: `20251124084604_add_client_name_to_appointments`

- **Исправлена проблема с часовыми поясами**
  - Время теперь сохраняется в UTC (использование `Date.UTC()`)
  - При отображении используется UTC время без конвертации
  - Единообразное отображение времени во всех компонентах
  - Исправлены функции проверки доступности времени
  - Исправлено отображение времени в таблице записей
  - Исправлено отображение времени в форме редактирования

- **Обновлена схема БД**
  - Добавлено поле `clientName String?` в модель `Appointment`
  - Обновлены все TypeScript интерфейсы

---

## Дата: 24 ноября 2024 (продолжение)

### ✅ Реализована модель блокировок времени

#### 1. Модель данных

- **`prisma/schema.prisma`** - Добавлена модель `TimeBlock`
  - Enum `TimeBlockType` с типами: `DAY_OFF`, `VACATION`, `BREAK`
  - Поля: `id`, `type`, `startDateTime`, `endDateTime`, `description`, `createdAt`, `updatedAt`
  - Составной индекс на `[startDateTime, endDateTime]` для быстрого поиска пересечений
  - Индекс на `type` для фильтрации по типу
  - Миграция БД: `20251124111945_add_time_blocks`

#### 2. API endpoints для блокировок

- **`app/api/time-blocks/route.ts`**
  - `GET` - получение списка блокировок с фильтрами:
    - По диапазону дат (`dateFrom`, `dateTo`)
    - По типу блокировки (`type`)
    - Сортировка по `startDateTime` (asc)
  - `POST` - создание блокировки
    - Валидация через Zod
    - Проверка, что `endDateTime > startDateTime`

- **`app/api/time-blocks/[id]/route.ts`**
  - `PUT` - обновление блокировки
  - `DELETE` - удаление блокировки
  - Проверка существования записи

#### 3. Утилиты для проверки блокировок

- **`lib/utils/time-blocks.ts`**
  - `isTimeBlocked()` - проверка, заблокировано ли время для интервала
  - `getOverlappingTimeBlocks()` - получение всех блокировок, пересекающихся с интервалом
  - Логика пересечения: `(start < block.end) && (end > block.start)`

#### 4. Интеграция блокировок в API

- **`app/api/appointments/available-slots/route.ts`**
  - Добавлена проверка блокировок в функцию `isSlotAvailable`
  - Получение блокировок для целевой даты
  - Фильтрация слотов, которые попадают в блокировки

- **`app/api/appointments/route.ts`**
  - Добавлена проверка блокировок в функцию `isTimeSlotAvailable`
  - Возврат сообщения "Время заблокировано" при блокировке

#### 5. UI для управления блокировками

- **`app/admin/time-blocks/page.tsx`** - Страница управления блокировками
  - Загрузка списка блокировок
  - Управление формой создания/редактирования
  - Обработчики для добавления, редактирования и удаления

- **`components/admin/time-blocks-table.tsx`** - Таблица блокировок
  - Отображение типа с цветовыми индикаторами
  - Форматирование дат и времени в локальное время
  - Вычисление и отображение длительности
  - Кнопки редактирования и удаления

- **`components/admin/time-block-form.tsx`** - Форма блокировок
  - Модальное окно для создания/редактирования
  - Поля: тип, дата начала, время начала, дата окончания, время окончания, описание
  - Объединение date + time в UTC DateTime для отправки на сервер
  - Валидация на клиенте и сервере

- **`app/admin/layout.tsx`** - Обновлена навигация
  - Добавлена ссылка "Блокировки" в меню

### ✅ Реализован календарь в админке

#### 1. Утилиты для календаря

- **`lib/utils/calendar.ts`**
  - `appointmentToCalendarEvent()` - преобразование записей в формат для react-big-calendar
  - `timeBlockToCalendarEvent()` - преобразование блокировок в формат для календаря
  - `getEventStyle()` - получение стилей событий по типу/статусу
  - Правильное преобразование UTC времени в локальное для отображения

#### 2. Компонент календаря

- **`components/admin/appointments-calendar.tsx`**
  - Интеграция с `react-big-calendar`
  - Локализация на русский язык через `date-fns`
  - Поддержка drag & drop для записей
  - Обработка изменения диапазона дат
  - Кастомные стили событий (разные цвета для статусов и типов)

#### 3. Страница календаря

- **`app/admin/appointments/calendar/page.tsx`**
  - Загрузка записей и блокировок для выбранного диапазона дат
  - Отображение событий на календаре с разными цветами:
    - Записи: зеленый (подтверждено), желтый (ожидает), серый (отменено)
    - Блокировки: красный (выходной), синий (отпуск), желтый (перерыв)
  - Клик на запись открывает форму редактирования
  - Клик на блокировку показывает детали в диалоге
  - Drag & drop для изменения времени записей с валидацией
  - Легенда с объяснением цветов
  - Автоматическое обновление данных при изменении диапазона

#### 4. Навигация и стили

- **`app/admin/layout.tsx`** - Добавлена ссылка "Календарь" в меню
- **`app/globals.css`** - Добавлены кастомные стили для react-big-calendar
  - Стилизация тулбара, заголовков, событий
  - Интеграция с дизайном приложения

#### 5. Исправление проблемы с отображением времени

- **Проблема**: Время в календаре не соответствовало времени в БД из-за конвертации часовых поясов
  - Запись на 13:00 UTC отображалась как 20:00 в календаре (при часовом поясе +7)
- **Решение**: 
  - При отображении: UTC компоненты используются как локальные значения (игнорирование часового пояса)
  - При сохранении: локальные компоненты сохраняются как UTC значения
  - Это обеспечивает соответствие времени в календаре времени в БД
  - Исправлено в `lib/utils/calendar.ts` (функции `appointmentToCalendarEvent` и `timeBlockToCalendarEvent`)
  - Исправлено в `app/admin/appointments/calendar/page.tsx` (функция `handleEventDrop`)

### Технические детали реализации блокировок и календаря

- Использование **react-big-calendar** для визуализации
- Локализация через **date-fns** на русский язык
- Правильная работа с **UTC временем** в БД и локальным временем для отображения
- **Drag & drop** для изменения времени записей с валидацией
- Кастомные стили событий для разных типов и статусов
- Автоматическое обновление данных при изменении диапазона дат

- Использование **UTC** для хранения времени в БД
- Использование **UTC методов** (`getUTCHours()`, `getUTCMinutes()`) для отображения
- **Debounce** для поиска (500ms)
- **Zod** валидация на сервере
- **TypeScript** типизация всех компонентов
- Обработка ошибок с понятными сообщениями

### Функциональность админ-панели записей

✅ Просмотр записей:
- Таблица со всеми записями
- Сортировка по дате (новые первыми)
- Форматирование даты, времени и телефона

✅ Фильтрация и поиск:
- Поиск по имени клиента или телефону
- Фильтр по статусу
- Фильтр по услуге
- Фильтр по диапазону дат
- Сброс всех фильтров

✅ Управление записями:
- Изменение статуса (подтвердить/отменить)
- Редактирование записи (дата, время, услуга, имя, телефон, статус)
- Удаление записи (с подтверждением)
- Проверка доступности времени при редактировании

✅ Настройки:
- Управление рабочим временем
- Управление интервалом между слотами
- Валидация настроек

✅ Блокировки времени:
- Создание блокировок (выходной, отпуск, технический перерыв)
- Редактирование и удаление блокировок
- Отображение блокировок в календаре
- Автоматическое исключение заблокированного времени из доступных слотов
- Проверка блокировок при создании и редактировании записей

✅ Календарь:
- Визуализация всех записей и блокировок на календаре
- Разные цвета для разных статусов записей и типов блокировок
- Просмотр в режимах: месяц, неделя, день
- Клик на запись открывает форму редактирования
- Клик на блокировку показывает детали
- Drag & drop для изменения времени записей
- Автоматическое обновление при изменении диапазона дат
- Легенда с объяснением цветов
- Правильное отображение времени (соответствие БД)

---

## Следующие шаги

### Приоритет 1: Завершение функционала бронирования

- [x] **API для создания записей (Appointments)** ✅
- [x] **Проверка доступности времени** ✅
- [x] **Интеграция формы бронирования с API** ✅

### Приоритет 2: Админ-панель для записей

- [x] **Страница управления записями** ✅
- [x] **Действия с записями** ✅
- [x] **Настройки рабочего времени** ✅
- [x] **Календарь в админке** ✅
  - Визуализация расписания
  - Отображение записей на календаре
  - Drag & drop для изменения времени

- [x] **Настройки рабочего времени** ✅
  - Страница настроек в админке (`app/admin/settings/page.tsx`)
  - Управление часами работы (начало/конец рабочего дня)
  - Настройка интервала между временными слотами (15/30/60 минут)
  - Сохранение настроек в БД (модель `Settings`)
  - Использование настроек в API `/api/appointments/available-slots`
  - Валидация настроек (начало < конца, интервал > 0)

### Приоритет 3: Блокировка времени

- [x] **Модель блокировок в БД** ✅
  - Таблица `TimeBlock` в схеме Prisma
  - Enum `TimeBlockType` с типами: DAY_OFF, VACATION, BREAK
  - Поля: id, type, startDateTime, endDateTime, description, timestamps
  - Индексы для оптимизации поиска пересечений
  - Миграция БД: `20251124111945_add_time_blocks`

- [x] **UI для управления блокировками** ✅
  - Страница `/admin/time-blocks` в админке
  - Таблица блокировок с отображением типа, дат, длительности
  - Форма создания/редактирования блокировок
  - Отображение блокировок в календаре

- [x] **Логика исключения блокировок** ✅
  - Проверка при создании записи
  - Исключение из доступных слотов
  - Интеграция в API `/api/appointments/available-slots`
  - Интеграция в API `/api/appointments` (функция `isTimeSlotAvailable`)

### Приоритет 5: Аутентификация (критично для продакшена)

- [x] **Настройка NextAuth** ✅
  - Конфигурация провайдеров (Credentials для начала)
  - Страница входа (`app/auth/login/page.tsx`)
  - Middleware для защиты админ-роутов (`middleware.ts`)
  - Сессии и cookies

- [x] **Роли пользователей** ✅
  - Использование существующего поля `role` в модели User
  - Проверка прав доступа в middleware
  - Редирект неавторизованных пользователей
  - Создание первого админа (seed script или отдельная страница)

- [x] **Защита API endpoints** ✅
  - Проверка авторизации в API routes
  - Проверка роли ADMIN для админских endpoints

### Приоритет 6: Улучшения UX

- [x] **Toast уведомления** ✅
  - Установка библиотеки (react-hot-toast или sonner)
  - Уведомления при успешных операциях (создание, обновление, удаление)
  - Уведомления об ошибках
  - Подтверждение действий в админке

- [ ] **Оптимизация загрузки**
  - [x] Skeleton loaders для списков (услуги, записи) ✅
  - Оптимистичные обновления UI (изменение статуса)
  - Кэширование данных через React Query или SWR
  - Пагинация для больших списков записей

- [ ] **Улучшение форм**
  - Автозаполнение телефона при поиске существующего клиента
  - История записей клиента при редактировании (если найден по телефону)
  - Валидация в реальном времени
  - Подсказки и placeholder'ы

- [ ] **Дополнительные фичи**
  - Экспорт записей в CSV/Excel
  - Статистика записей (количество по статусам, по услугам)
  - Поиск клиента по телефону с отображением истории записей
  - Напоминания о записи (SMS/Email - опционально, требует интеграции)
  - [x] **Управление администраторами** ✅
    - Страница `/admin/admins` для просмотра списка администраторов
    - Форма создания нового администратора (телефон, имя, пароль)
    - Возможность удаления администратора (преобразование в клиента)
    - API endpoints: `GET /api/admins`, `POST /api/admins`, `DELETE /api/admins/[phone]`
    - Защита endpoints проверкой роли ADMIN
    - Валидация данных (формат телефона, минимальная длина пароля)
    - Предотвращение удаления самого себя

### Приоритет 7: Исправления и улучшения

- [x] **Исправлена проблема с перезаписью имени клиента** ✅
- [x] **Исправлена проблема с часовыми поясами** ✅

- [ ] **Миграция данных (если нужно)**
  - Скрипт для заполнения clientName для существующих записей из user.name
  - Проверка целостности данных

- [ ] **Валидация и обработка ошибок**
  - Улучшение сообщений об ошибках
  - Валидация на клиенте для всех форм
  - Обработка edge cases (например, изменение времени на уже занятое)

### Технический долг

- [ ] Добавить обработку ошибок на всех уровнях
- [ ] Добавить логирование важных событий
- [ ] Написать тесты для критичных функций
- [ ] Оптимизировать запросы к БД (N+1 проблемы)
- [ ] Добавить rate limiting для API endpoints
- [ ] Добавить индексы для clientName (если нужен поиск)

